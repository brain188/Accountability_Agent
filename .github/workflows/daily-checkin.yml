name: Daily Check-in Email

on:
  schedule:
    # Runs at 5:00 PM UTC (6:00 PM WAT) Monday-Friday
    # Adjust time based on your timezone
    - cron: '0 17 * * 1-5'
  
  # Allows manual trigger from GitHub Actions tab
  workflow_dispatch:

jobs:
  send-checkin:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run daily check-in script
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}
          SENDGRID_FROM_EMAIL: ${{ secrets.SENDGRID_FROM_EMAIL }}
          SENDGRID_REPLY_TO_EMAIL: ${{ secrets.SENDGRID_REPLY_TO_EMAIL }}
          TIMEZONE: ${{ secrets.TIMEZONE }}
          WEBHOOK_SECRET: ${{ secrets.WEBHOOK_SECRET }}
          APP_NAME: "Personal AI Agent"
          APP_VERSION: "1.0.0"
          DEBUG: "False"
          LOG_LEVEL: "INFO"
        run: |
          python cron/send_daily_checkins.py